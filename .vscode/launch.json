{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "KontextT2I 1201 debug",
            "type": "python",
            "request": "launch",
            "program": "examples/flux/model_training/train.py", // 关键：指定 accelerate 可执行文件路径
            "args": [
                "--dataset_base_path", "/fi-lib/workspace/sjx/DiffSynth-Studio/dataset/multi_frame",
                "--dataset_metadata_path", "/fi-lib/workspace/sjx/DiffSynth-Studio/dataset/multi_frame/pairs.txt",
                "--data_file_keys", "image,prompt",
                "--max_pixels", "1048576",
                "--dataset_repeat", "400",
                "--model_id_with_origin_paths", "black-forest-labs/FLUX.1-Kontext-dev:flux1-kontext-dev.safetensors,black-forest-labs/FLUX.1-Kontext-dev:text_encoder/model.safetensors,black-forest-labs/FLUX.1-Kontext-dev:text_encoder_2/,black-forest-labs/FLUX.1-Kontext-dev:ae.safetensors",
                "--learning_rate", "1e-5",
                "--num_epochs", "5",
                "--remove_prefix_in_ckpt", "pipe.dit.",
                "--output_path", "./models/train/FLUX.1_lora_1127_mbti",
                "--lora_base_model", "dit",
                "--lora_target_modules", "a_to_qkv,b_to_qkv,ff_a.0,ff_a.2,ff_b.0,ff_b.2,a_to_out,b_to_out,proj_out,norm.linear,norm1_a.linear,norm1_b.linear,to_qkv_mlp",
                "--lora_rank", "32",
                "--align_to_opensource_format",
                "--use_gradient_checkpointing",
                "--default_caption", "Convert this real photo into a mbti style."
            ],
            "console": "integratedTerminal", // 输出日志到 VS Code 内置终端（方便查看）
            "justMyCode": false, // 允许调试第三方库（如 accelerate、transformers）
            "cwd": "${workspaceFolder}", // 工作目录设为项目根目录（确保路径正确）
            "env": {
                "PYTHONUNBUFFERED": "1", // 禁用输出缓冲，实时查看日志
                "CUDA_VISIBLE_DEVICES": "7"
            }
        }
    ]
}